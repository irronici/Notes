# 09 JPEG

[toc]

## 概念

+ 压缩比$CR=原始图像的数据量/压缩后图像的数据量$

## 基于DCT的顺序编码

1. 预处理和FDCT
   + 将RGB颜色空间转换为$YC_rC_b/YIQ/YUV$空间（每个像素有自己的$Y$,$C_r, C_b/IQ/UV$可以两个像素共用一个）
   + 将图像分量划分为若干8*8的子块
   + 电平偏移：从$[0 , 255]$平移到$[-128 , 127]$，进行DCT（离散余弦变换）变换后得到的范围从$\left[-2^{p-1}, 2^{p-1}-1\right]$变为$\left[-2^{p+2}, 2^{p+2}-1\right]$

2. 二维离散余弦变换

   设 $f(i, j)=\left[\begin{array}{c}\mathrm{f}_{0,0}, \ldots, \mathrm{f}_{0,7} \\ \mathrm{f}_{7,0, \ldots} \mathrm{f}_{7,7}\end{array}\right]$ 是64个象素的子图象块
   则DCT变换为：$F(u, v)=\frac{C(u) C(v)}{4} \sum_{r=0}^{7} \sum_{t=0}^{7} \cos \frac{(2 i+1) u \pi}{16} \cos \frac{(2 j+1) v \pi}{16} f(i, j)$
   IDCT变换为：$\widetilde{f}(i, j)=\sum_{i=0}^{7} \sum_{j=0}^{7} \frac{C(u) C(v)}{4} \cos \frac{(2 i+1) u \pi}{16} \cos \frac{(2 j+1) v \pi}{16} F(u, v)$

   + 其中,当u=0,v=0 时, $C(u)=C(v)=\sqrt{2} / 2,$ 否则, $C(u)=C(v)=1$

3. DCT系数量化：$\widehat{F}(u, v)=\operatorname{round}\left(\frac{F(u, v)}{Q(u, v)}\right)$

   + 其中$F(0,0)$是直流系数，剩余为交流系数，越右下频率越高

   + $Q(u,v)$为量化阶，$Q(u,v)=Q*V(u,v)$，其中$Q$为质量因子，$V$为亮度量化表/色度量化表
   + $Q$越小，$CR$越低图像质量越好
   + 高频信号较多时，量化后逆量化会与原始数据相差比高频信号少时更多

4. 直流系数$DC_i$的处理：$F^Q(0,0)$是子图象块的直流系数，一幅图象的所有直流系数使用 DPCM编码, 即: $\quad \triangle D C_{i}=D C_{i}-D C_{i-1}$

5. 交流系数$AC$的处理：将$FQ(u,v)$按“Z"字形排成一个一维数组ZZ(1,63)（频率从低到高）

   + 用行程长度对其进行编码（此处的行程长度为：**遇到了i个0才遇到非0值x**，表示为$i\;x$，0 0表示剩下的都是0）

6. 直流/交流系数的VLI编码

   + 直流系数差分值：用两个符号表示

     + 符号1：表示非零值的位数（4bits，范围从1~10）
     + 符号2：表示非零值的大小（可变长整数，负数用**反码**表示）

   + 交流系数：用两个符号表示

     + 符号1：高4bits：行程长度（0~15）；低4bits：非零值的位数（8bits）
       + 若符号1=F0，表示连续16个0（当15<行程长度时用），后跟正常符号表示，若符号1=00，表示子块剩下都是0
     + 符号2：非零值的大小

  7. 对**符号1**做Huffman编码（码表是**固定**的，表示概率是来自自然界的，而不是本图片的）（考试不用管）



### 小结：JPEG压缩编码过程：

1. 首先做颜色变换，从RGB转换到YIQ（或其他）

2. 然后做电平偏移，从0\~255偏移到-128\~127

3. 再做一个8*8的分块，每一个分块做DCT变换，就得到一个8\*8的DCT系数$F$

4. 对F进行量化，得到量化后的DCT系数

5. 对量化后系数拉成一个Z字型的一维数组，其第0个 为直流系数，直流系数与上一个块的直流系数进行差分，即差分编码；交流系数用行程长度进行编码，形成元素对 

6. 对系数进行变长编码

7. （对符号1）进行Huffman编码



**\*Joint Photographic Experts Group, JPEG**

## 累进编码

顺序编码是一行一行的编码，累进编码是先给一个粗糙的图像，再慢慢地细化

