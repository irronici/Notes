# 图像分割

[toc]



## 基础知识

+ 分割基本原理
  + 灰度不连续性：根据灰度的突变分割。区域的边界差异很大
  + 灰度相似性：区域内的像素依据某些准则很相似

+ 边缘
  + 边缘像素：灰度发生剧烈变化；边缘：连通的边缘像素的集合
  + 线：两侧灰度值都很大/很小
  + 点：长宽只有一个像素的线

+ 背景知识

  + 一阶导数通常产生较粗的边缘
  + 二阶导数对细节有较强的相应，在斜坡和台阶产生双边缘响应，且符号变化有指示意义
    + \+ → \-  暗到亮
  + 求导通过空间滤波实现


## 点、线、边缘检测

+ 孤立点检测：用二阶导数

  + 滤波器：拉普拉斯算子：$\nabla^{2} f(x, y)=\frac{\partial^{2} f}{\partial x^{2}}+\frac{\partial^{2} f}{\partial y^{2}}\\=f(x+1, y)+f(x-1, y)+f(x, y+1)+f(x, y-1)-4 f(x, y)$

  + 检测方法：阈值化处理

    根据响应幅度是否大于某阈值$T$ : $g(x, y)=\left\{\begin{array}{ll}
    1 & \text { if }|R(x, y)| \geq T \\
    0 & \text { otherwise }
    \end{array}\right.$

  + 

+ 线检测：二阶导数检测线（需要留意双线效应）

  + 双线效应：<img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20200520165045195.png" alt="image-20200520165045195" style="zoom: 67%;" />，可以通过取绝对值/保留正数(这个更好)的方法解决

  

+ 边缘模型

  + 台阶：一个像素距离上发生灰度级的理想过度

    <img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20200520170953975.png" alt="image-20200520170953975" style="zoom: 50%;" />

  + 斜坡：通常是模糊、噪声。斜率与模糊程度成反比

  <img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20200520171130877.png" alt="image-20200520171130877" style="zoom:50%;" />

  + 屋顶：表示穿过区域的线

    <img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20200520171206686.png" alt="image-20200520171206686" style="zoom:50%;" />

  + 存在噪声的边缘

    >  视觉上并不影响。但噪声对导数影响很大，二阶导更敏感

    + 基本步骤
      1. 平滑图像
      2. 边缘点检测，抽取所有潜在边缘点
      3. 边缘定位，选出真正的边缘点


## 边缘连接和边缘检测

+ 基本边缘检测：用梯度算子进行空间滤波

  + 噪声平滑/阈值化+空间滤波

+ 高级边缘检测

  + Marr-Hildreth边缘检测器

  + Canny边缘检测器

    + 步骤：

      1. 高斯函数平滑输入图像$f$：$f_{s}(x, y)=G(x, y) \star f(x, y)$，其中$G(x, y)=e^{-\frac{x^{2}+y^{2}}{2 \sigma^{2}}}$
      2. 计算图像梯度：
         + 梯度大小 $M(x, y)=\sqrt{g_{x}^{2}+g_{y}^{2}}$
           梯度方向 $\alpha(x, y)=\tan ^{-1}\left[\frac{g_{y}}{g_{x}}\right]$
           其中 $g_{x}=\partial f_{s} / \partial x, g_{y}=\partial f_{s} / \partial y$

      3. 非最大抑制：把梯度生成的粗边缘变细

         + 考虑 $(x, y)$ 为中心的$3 \times 3$ 区域

         + 考虑4个方向：水平、垂直、+45°、-45°

         + 确定和梯度 $a(x, y)$ 最接近的方向 $d_{k}$

         + 如果M( $x, y$ )的值比 $(x, y)$ 在 $d_{k}$ 方向的任一邻居 数值小，对其抑制：$g_{N}(x, y)=0$
           否则，保留：$g_{N}(x, y)=M(x, y)$

      4. 滞后阈值：减少伪边缘点
         + 两个阈值：低阅值$T_L$、高阈值 $T_{H}$（两个阅值的比值为：2:1或3:1）
         + 利用$T_H$阈值化：强边缘点$g_{N H}(x, y)=g_{N}(x, y) \geq T_{H}$
           利用 $T_{L}$阈值化：弱边缘点$g_{N L}(x, y)=g_{N}(x, y) \geq T_{L}$（$g_{N L}$ 包含 $g_{N H}$ 的所有非零元素）
         + 去掉 $g_{N L}$ 中和 $g_{N H}$ 重复的点$g_{N L}(x, y)=g_{N L}(x, y)-g_{N H}(x, y)$
      5. 连通性分析
         1. 遍历 $g_{N H} $ 中的每一个点 $p$，保留 $g_{N L}$ 中和p连通 $($ 例如8连通 ) 的点
         2. 去掉 $g_{N L}$ 剩余的点
         3. 合并 $g_{N H}$ 和 $g_{N L}$

+ 边缘连接
  + 局部处理
    1. 计算输入图像 $f(x, y)$ 的梯度大小$M(x,y)$和梯度方向$a(x, y)$
    2. 依据下式生产二值图像
        $g(x, y)=\left\{\begin{array}{ll}1 & \text { if } M(x, y)>T_{M} \mathrm{ AND   } \alpha(x, y)=A \pm T_{A} \\ 0 & \text { othervise }\end{array}\right.$
        $T_{M}$ 为阅值、A为特定角度、 $T_{A}$ 为允许的带宽
    3. 逐行扫描，填充长度不超过K的空隙
    4. 以角度$\theta$旋转g( $x, y$ ) , 重复第3步 , 再反旋转
  + 区域处理
    1. 令P是一个已排序、不重复的二值图像中的序列指定两个起始点A和B。它们是多边形的两个起始顶点。
    2. 指定一个阈值T，以及两个空堆栈“开”(OPEN)和“闭”(CLOSED)。
    3. 如果P中的点对应于一条闭合曲线，则把B放到" 开"和“闭"中，并把A放到“开”中。 如果对应于一条开放曲线，则把A放到“开”中， 而把B放到"闭"。
    4. 计算从“闭"中最后一个顶点到“开”中最后一个顶点的线的参数。
    5. 寻找属于序列P、目在步骤4中直线的**两个顶点之间**(按顺/逆时针顺序)的点 ; 计算这些点与直线的距离，选择具有最大距离 $D_{max}$的点 $V_{\max }$
    6. 如果$D_{max}$ > T , 则把 $V_{m a x}$ 作为一个新顶点放在"开"堆栈的末尾。转到步骤4。
    7. 否则，从“开”中移除最后一个顶点，并把它作为" 闭"的最后一个顶点插入。
    8. 如果“开”非空，转到步骤4。
    9. 否则，退出。“闭"中的顶点就是拟合P中的点的多边形的顶点。
  + 全局处理（霍夫变换）
    + 

