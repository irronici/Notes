## 数字图像基础

[toc]

### 可感知的光

+ 单色光
  + 没有颜色的光，唯一的属性：强度（灰度/强度不做区分）
  + 单色图像也被称为灰度图像。灰度：表示强度的数值
+ 彩色光：约为0.43nm-0.79nm电磁波
  + 辐射：能量（瓦特）
  + 光强：感知的能量（流明）
  + 亮度：主观描绘
+ 观测精度：波长必须小于物体尺寸

### 图像形成模型

+ 二维函数 $f(x,y)=i(x,y)r(x,y)$,  $0<f(x,y)<\infin$

  入射分量: $0<i(x,y)<\infin$
  反射分量: $0<i(x,y)<1$

  + 0表示全部吸收，1表示全部吸收

### 图像的取样和量化

+ 目的：将连续图像转换为数字图像

+ 取样：对坐标进行数字化

+ 量化：对幅值进行数字化

  <img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20200224145745936.png" alt="image-20200224145745936" style="zoom:50%;" />)
  <img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20200224145820314.png" alt="image-20200224145820314" style="zoom:50%;" />

+ 2维数组f(x,y)
  
  + 包含M行、N列
  
  + f(x,y)表示在(x,y)处的值
  
+ 表示数字图像

  + 灰度级数$L=2^k, k∈Z$，灰度值$[0,L-1]$内的整数
  + 存储一幅图像的比特数需要$M×N×k$个比特数
    + 图像有2^k^个灰度级别时，称为k比特图像
  + 动态范围：最大可测量灰度和最小可检测灰度的比值
    + 饱和度：最大可测量灰度，超过饱和度就是常数
    + 噪声干扰：若最小数值与噪声在同一个量级上会被噪声干扰
  + 对比度：最高和最低灰度之间的差值
    + 对比度高，动态范围广

#### 空间和灰度分辨率

+ 空间分辨率：图像中可辨别的最小细节度量

  + 衡量标准：单位距离线对数、单位距离点数
  + 要指明空间单位，像素大小并不能表示清晰程度，但是可以用来反映设备的成像能力

+ 灰度分辨率：灰度级别可体现的最小变化

  + 用比特数表示灰度分辨率，如256（2^8^）个灰度级别意味着8比特灰度分辨率

+ 联合影响

  + 图像细节越多，需要的比特数越小

  + 增加空间分辨率，可适当降低比特数

    <img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20200224152857424.png" alt="image-20200224152857424" style="zoom: 67%;" />

    + 其中Face有少量细节，Cameraman有中等细节，Crowd有大量细节

#### 最佳量化

+ 使量化误差最小的量化方法：使用均方误差评价量化质量
+ 计算
  + Z, 图像灰度，在[H~1~,H~2~]；q, 灰度量化值；p(Z), 像素灰度概率密度函数；K, 量化层数（将灰度取值分成K个数字）
  + 均方误差
  + 结论：Z~K~位于q~k-1~和q~k~中间，q~K~位于Z~k~和Z~k+1~中间，量化误差：$\frac{(H_2-H_1)^2}{12K^2}$

#### 图像内插★

+ 用已知数据来估计未知位置的数值

  + 在进行放大、缩小、旋转、几何校正后对灰度的操作

##### 最近邻内插：使用最近邻的像素进行赋值

<img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20200224161658956.png" alt="image-20200224161658956" style="zoom: 50%;" />

  + 不平滑，会失真

##### 线性内插1：两点间用直线连起来

+ <img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20200224162005995.png" alt="image-20200224162005995" style="zoom:50%;" />

##### 线性内插2：取权重

+ <img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20200224162213045.png" alt="image-20200224162213045" style="zoom:50%;" />
  + 权重与距离成反比，黑线代表权重

##### 双线性内插（线性）：用三次线性内插

<img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20200224162731002.png" alt="image-20200224162731002" style="zoom: 80%;" />
    

   + 先算R1、R2，在用R1、R2算P

##### 双线性内插（非线性）

双线性插值的结果不是线性的，它是两个线性函数的积。在单位正方形上，双线性插值可以记作：
$$
f(x,y)= \sum_{i=0}^{1}\sum_{j=0}^{1}a_{ij}x^iy^j=a_{00}+a_{10}x+a_{01}y+a_{11}xy
$$
利用4个近邻点构造方程组，求解得到系数
$$
\begin{bmatrix}
1 & x_1 & y_1 & x_1y_1\\ 
1 & x_1 & y_2 & x_1y_2\\ 
1 & x_2 & y_1 & x_2y_1\\ 
1 & x_2 & y_2 & x_2y_2
\end{bmatrix}
\begin{bmatrix}
a_0 \\ a_1 \\ a_2 \\ a_3
\end{bmatrix}
=
\begin{bmatrix}
f(Q_11) \\ f(Q_12) \\ f(Q_21) \\ f(Q_22)
\end{bmatrix}
$$

##### 双三次内插

+ 方法1：

  已知：函数$f$，一阶导数$f_x, f_y$，二阶导数$f_{xy}$，以及**4**个坐标点如(0,0), (1,0), (0,1), (1,1)，计算插值函数$p(x,y)$

  过程：

  1. 根据函数值建立等式
  2. 根据一阶导数建立等式
  3. 根据二阶导数建立等式
  4. （若在离散情况下，可以通过微分的方式获得函数$f$的导数）

+ 方法2：

  用**16**个近邻点坐标代入公式
  $$
  f(x,y)= \sum_{i=0}^{1}\sum_{j=0}^{1}a_{ij}x^iy^j
  $$
  列出方程并求解系数即可



### 像素间的关系

相邻是要指明何种相邻还是满足一种都算是相邻？

#### 相邻像素

+ 像素$p=(x,y)$的4邻域$N_4(p)$：<img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20200813212400524.png" alt="image-20200813212400524" style="zoom:50%;" />
+ 4对角邻域$N_D(p)$:<img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20200813212428720.png" alt="image-20200813212428720" style="zoom:50%;" />
+ 8邻域=$N_D(p)$+$N_4(p)$

#### 邻接性

+ 4邻接、8邻接
+ m邻接
  + p和q的灰度值均属于集合V
  + 以下条件满足任意一条：
    1. q属于p的4邻域, 即 $q \in N_{4}(p)$
    2. q属于p的4对角邻域, 即 $q \in N_{D}(p)$, 并且 $N_{4}(p) \cap N_{4}(q)$ 中没有元素的灰度属于V
  + 目的是：消除歧义

#### 连通性

+ 4通路、8通路、m通路
+ n为通路的长度

+ 连通分量

+ 连通集

#### 区域

R是图像中某一子集，若R是一个连通集，则R是一个区域

若区域R1、R2的并集形成一个连通集，则R1、R2是邻接的

#### 边界

+ 前景：图像中包含 $K$ 个不连接的区域 $R_{1}, \ldots, R_{K}$（这些区域都不接触图像的边界）
+ 背景：前景的补集
+ 内边界
  + 与区域R补集8邻接的像素点集合（边界属于R）
  + 区域与背景之间的邻接使用**8邻接**
+ 外边界
  + 在背景中定义的边界
  + 通常是闭合通路

#### 边缘

灰度值的导数（灰度值的变化）超过某阈值的像素，是一个局部的概念，反映了局部灰度发生变化

+ 边缘 vs. 边界：边界通常形成闭合通路，是整体的概念

对于二值图像，边界与边缘定义重合

#### 距离度量

设三个像素点$p=(x,y), q=(s,t), z=(v,w)$

+ D是距离函数
  + 3条

+ 欧氏距离

+ $D_4$距离（城市街区距离/曼哈顿距离）
+ $D_8$距离（棋盘距离）$=\max (|x-s|,|y-t|)$
+ $D_m$距离：两点之间最短的m通路的长度



---



### 数学工具

<img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20200302145841325.png" alt="image-20200302145841325" style="zoom: 50%;" />



#### 阵列与矩阵操作

#### 线性和非线性操作

#### 算术操作

#### 集合和逻辑操作

#### 空间操作

#### 向量和矩阵操作

#### 图像变换

#### 概率方法



最大值操作不是线性操作

算术操作是阵列操作（对应元素相互运算）

+ 加法操作
  + 图像去噪：对K幅不同的图像求平均

+ 减法
  + 增强图像间的差异

+ 乘除法
  + 阴影矫正

灰度归一化

+ 算术操作结果可能不属于[0,255]
+ 简单做法：
  + 负数设置为0，大于255的设置为255

+ 保留更多信息的做法

#### 集合操作

#### 空间操作

+ 单像素操作：以灰度为基础改变单个像素的值$S=T(z)$
  + z为原像素的灰度，s是处理后的灰度

#### 领域操作

+ S_xy表示像素(x,y)领域像素点的集合
+ 使用S_xy中所有像素计算一个输出



 #### 几何空间变换

改变图像中像素间的空间关系

1. 坐标的空间变换（变换后原整数位置的坐标可能变成非整数，所以要进行内插）
2. 灰度内插

##### 仿射变换

包括旋转、伸缩、平移、倾斜等变换

+ 保持共线性
+ 保持距离比例

##### 灰度内插

+ 前向映射
+ 反向映射（更有效）

##### 图像配准

+ 问题定义：找出（估计）输入图像与输出图像的变化函数

+ 用途：

  + 相似时间内不同设备的图像（）
  + 相同设备不同时间拍摄的图像（全景、卫星定期拍摄某地方）

+ 方法：点匹配法：在图像中寻找对应的点

  求解最小二乘：
  $$
  \min_{T}\left \| Q-PT \right \|^2_F
  $$

  + F范数的平方指的是矩阵的范数，即矩阵的平方求和，在这里表示Q-PT得到的值的平方和

  + 找一个矩阵T（仿射变换矩阵）使得误差最小，用 求导=0

  + 最优解（闭合解）：
    $$
    T=(P^TP)^{-1}P^TQ
    $$

+ 一般流程

  + 建模（双线性近似）

    + $$
      x=c_1v+c_2w+c_3vw+c_4\\
      y=c_5v+c_6w+c_7vw+c_8
      $$

    + 找约束点（人工、算法找）：8个参数只用4个点，求解方程组

      + 方程组未必有解，也可以用最小二乘法的方法来做

    + 执行映射：灰度内插

    + 若图像很大，可以增加约束点

      + 将原图分成多个4边形，逐个处理

      

#### 向量和矩阵操作

##### 图像变换

+ 空间域：直接对图像的像素进行操作
+ 变换域：
  + 将图像从空间域变换到新的域
  + 在变换域对图像进行操作
  + 利用反变换返回空间域

+ 变换对：

  <img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20200309163504142.png" alt="image-20200309163504142" style="zoom: 50%;" />

  

  + 正变换核是可分的指：$r(x,y,u,v)=r_1(x,u)r_2(y,v)$
  + 正变换核是对称的指：$r(x,y,u,v)=r_1(x,u)r_1(y,v)$
  + <img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20200309163917688.png" alt="image-20200309163917688" style="zoom: 67%;" />
    + F是图像
  + <img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20200309164215732.png" alt="image-20200309164215732" style="zoom:67%;" />
    + $\hat{F}$ 表示不是F，与F有些误差

##### 傅里叶变换

<img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20200309212142098.png" alt="image-20200309212142098" style="zoom:50%;" />

+ 傅里叶变换去噪

  

#### 概率方法

+ 平均灰度：值越高图像越亮
+ 灰度的方差：值越大对比度越大，看起来越清楚