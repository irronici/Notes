# 数据库的物理组织

[TOC]

### 文件组织

记录在磁盘中间的分配方式

+ 单块单记录、单块多记录
  + 有无用部分、不能跨块
+ 多块单记录 有无用部分
+ 多块多记录 不存在空间浪费

### 索引技术

+ 顺序文件
+ 索引项：<img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20191229202442969.png" alt="image-20191229202442969" style="zoom:60%;" />

+ 顺序文件上的索引
  + 稠密索引
    + 文件中的每条记录都有一个对应的索引项
    + <img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20191229202828131.png" alt="image-20191229202828131" style="zoom:67%;" />
  + 稀疏索引
    + 若数据文件为顺序文件，可以为数据文件的每个磁盘块设一个索引项（指向磁盘块的第一条数据）
  + 多级索引
  + 若键值不唯一，则可以用具有重复键值的索引（了解就行）
+ 非顺序文件上的索引
  + 为非顺序文件建立第一级稠密索引
  + 建立该稠密索引上的多级稀疏索引

+ B/B+树索引文件：通常最下一级为稠密索引，其它层次为稀疏索引

  + 结点划分

    + 叶节点：最下一级索引
    + 根节点：最上一级索引

  + 特点

    + 平衡性：根节点到每个叶节点路径等长
    + 过半性：除根节点外的每个节点对应的磁盘块至少被占用一半
    + 顺序性：既可以从根节点开始随机查找关键字，也可以根据索引关键字的值的排序进行顺序访问
    + 自适应性：自动保持与数据文件大小相适应的索引层次

  + 结点结构

    <img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20191229214355825.png" alt="image-20191229214355825" style="zoom:67%;" />

    + P为指针，K为索引关键字值，K1<K2<...<Km

    1. 若为叶节点，则Pi指向的是Ki对应的数据记录，Pm+1指向下一叶节点
    2. 若为非叶节点，Pj指向的子树中任意一个索引关键字K，有Kj-1≤K＜Kj

  + B vs B+

    1. 组织方式不同
       + B+：有效的索引关键字值都在叶节点中，内部节点的键值只用于查找定位
       + B：有效索引关键字值可以出现在任意一个节点
    2. 内部节点不同
       + B+：关键字值+子树指针
       + B：关键字值+记录指针+子树指针
    3. 随机查找的效率不同
       + B+：所有关键字查找速度基本一致
       + B：取决于关键字所在节点的层次
    4. B树中没有索引关键字的顺序扫描功能
    5. B树的插入/删除比B+树复杂

### 散列技术

+ Hashing
+ 位图索引