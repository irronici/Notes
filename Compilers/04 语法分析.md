# 语法分析

[TOC]

### 概念

| 概念                                      | 释义                                                         |
| ----------------------------------------- | ------------------------------------------------------------ |
| 上下文无关文法 Context Free Grammar (CFG) | 由终结符、非终结符、开始符号、一组产生式组成                 |
| 句型                                      | 如果S<img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20191223215603563.png" alt="image-20191223215603563" style="zoom: 50%;" /> α，那么α就是文法的一个句型（可能既有非终结符又有终结符，还可能是空串） |
| 句子                                      | 不含非终结符的句型                                           |
| 语言                                      | 某文法句子的集合                                             |

### 推导

+ 把一个非终结符号替换为其某个产生式的体
+ 最左推导：总是选择每个句型的最左非终结符号（记作 <img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20191223201513610.png" alt="image-20191223201513610" style="zoom:80%;" />）
  + 最右规约为最左推导的逆过程
+ 最右推导：总是选择最右边的非终结符号（记作 <img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20191223201602961.png" alt="image-20191223201602961" style="zoom:80%;" />）

### 设计文法

+ 消除二义性

+ 消除左递归

  + 消除直接左递归

    + ​						*A→Aα*    --->	A → βA’

      ​												A’ → αA’ | ε

    + ​					<img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20191223212518626.png" alt="image-20191223212518626" style="zoom:50%;" />

      ​															↓

      <img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20191223212536357.png" alt="image-20191223212536357" style="zoom:50%;" />

  + 消除间接左递归（如果一个非终结符S出现在**产生式左边**，又出现在**产生式右边首位**，则要注意）

    **（不可以出现A1 → A2 B，要把A2用A2的产生式进行替换）**
    
    + 将产生式代入其他产生式，消除间接左递归，产生直接左递归
    + 消除直接左递归

+ 提取左公因子

  + 通过改写产生式来**推迟决定**，等读入足够多的信息后再作出正确的选择

### First & Follow

+ FIRST(α)

  + 可从α推导得到的串首终结符的集合

  + 计算

    + 如果X是终结符号，那么FIRST(X)={X}

    + 如果X是非终结符号，且有规则X →  a…,那么将a添加到FIRST(X)中; 如果X →  ε，那么ε也在FIRST(X)中

    + 对于规则X →  Y1 Y2 …Yn， 把FIRST(Y1)中的非ε符号添加到FIRST(X)中。

      如果ε在FIRST(Y1)中，把FIRST(Y2)中的非ε符号添加到FIRST(X)中…；

      如果ε在FIRST(Yn)中，把ε添加到FIRST(X)中

+ FOLLOW(α)

  + 可能在某些句型中紧跟在A的右部的终结符号集合
  + **如果A是某个句型最右符号，则将结束符“$”添加到FOLLOW(A)中**
  + 计算
    + 将$放入FOLLOW(S)，S是开始符号，而$是输入串的结束标记
    + 如果存在产生式A → αBβ，那么First(β)中除ε之外的所有符号都在Follow(B)中
    + 如果存在一个产生式A → αB，或存在产生式A→ αBβ且First(β)包含ε，那么Follow(A)中的所有符号都在Follow(B)中



### LL(1)文法

+ LL(1)文法，第一个L表示自左向右扫描，第二个L指产生最左推导，而1则表示向前看1个输入符号
+ **判断是不是LL(1)**
  + 对于文法的任意两个不同的产生式A → α|β
    + 不存在终结符号a使得α和β都可以推导出以a开头的串
    + α和β最多只有一个可以推导出空串
    + 如果β可以推导出空串，那么α不能推导出以FOLLOW 中任何终结符号开头的串；
  + 等价于：
    + FIRST(α)∩FIRST(β) = Φ;
    + 如果ε∈FIRST(β)，那么FIRST(α) ∩ FOLLOW(A) = Φ；反之亦然。
+ 预测分析表的构造
  + 方法：对于文法G的每个产生式A → α ，进行如下处理
    + 对于First(α)中的每个终结符号a，将A → α加入到M[A,a]
    + 如果 ε 在First(α)中，
      + 对于Follow(A)中的每个终结符号b，将A → α加入到M[A,b]中
      + 若$在Follow(A)中，将A → α加入到M[A,$]中

### 递归预测分析方法

+ 通用递归下降分析框架
  + 每个非终结符号对应一个过程
  + 程序的执行从开始符号对应的过程开始
  + 每个过程的功能是：选择一个产生式体，扫描相应的句子。若遇到非终结符号，调用该符号对应的过程

### 规范LR(0)项集族









### 移入/规约冲突

+ 如果栈顶符号是一个句柄，则采取规约动作，否则不能采取规约动作

+ 根据Follow集可知(书P155)
  eg：E→T· | T→T·*F  \*不在E的follow集中，即使规约出E，之后也不会跟\*,故此处不应该进行规约

### LR(1)

+ *A→α·β, a* a表示当前状态下A后面必须紧跟的终结符
+ *A→α* 后继符集合是FOLLOW(A)的子集
+ *A→α·Bβ, a*  
  *B→·γ, b*, 其中*b∈ FIRST(βa)* 